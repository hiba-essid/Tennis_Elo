<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Performance - Tennis Elo Predictions</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1f36 0%, #2d3561 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .back-link {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1em;
            margin-top: 10px;
        }
        
        .section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .section h2 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .chart-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .metric-label {
            font-size: 0.95em;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
        }
        
        .confusion-matrix {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .cm-cell {
            background: #f0f4ff;
            border: 2px solid #667eea;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .cm-label {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        
        .cm-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f9f9f9;
        }
        
        .model-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .badge-xgb {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .badge-lgb {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .badge-lr {
            background: #e8f5e9;
            color: #388e3c;
        }
        
        .insight-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .insight-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .insight-content {
            line-height: 1.8;
            opacity: 0.95;
        }
        
        .insight-content ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .insight-content li {
            margin: 8px 0;
        }
        
        footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            padding: 20px;
            opacity: 0.8;
        }
        
        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            table {
                font-size: 0.9em;
            }
            
            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="/" class="back-link">‚Üê Back to Predictions</a>
            <h1>üéØ Model Performance Dashboard</h1>
            <p class="subtitle">Training curves, accuracy metrics, and model evaluation</p>
        </header>
        
        <!-- Training Progress Section -->
        <div class="section">
            <h2>üìà Training Progress</h2>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Accuracy vs Epochs</div>
                    <div id="accuracy-chart"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Loss vs Epochs</div>
                    <div id="loss-chart"></div>
                </div>
            </div>
            
            <div class="insight-box">
                <div class="insight-title">üí° What These Curves Show</div>
                <div class="insight-content">
                    <ul>
                        <li><strong>Accuracy Curves:</strong> Show how well the model predicts correct outcomes. Higher is better. Convergence indicates the model has learned the patterns.</li>
                        <li><strong>Loss Curves:</strong> Measure prediction error. Lower is better. The gap between training and validation loss indicates overfitting risk.</li>
                        <li><strong>XGBoost & LightGBM:</strong> Fast tree-based learners with similar performance characteristics.</li>
                        <li><strong>Logistic Regression:</strong> Linear baseline - slower to converge but provides robustness to the ensemble.</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Model Metrics Section -->
        <div class="section">
            <h2>üìä Individual Model Metrics</h2>
            
            <div class="metrics-grid" id="metrics-grid">
                <!-- Populated by JavaScript -->
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Training Accuracy</th>
                        <th>Validation Accuracy</th>
                        <th>Training Loss</th>
                        <th>Validation Loss</th>
                    </tr>
                </thead>
                <tbody id="metrics-table">
                    <!-- Populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Ensemble Performance Section -->
        <div class="section">
            <h2>üèÜ Ensemble Performance</h2>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Overall Accuracy</div>
                    <div class="metric-value">92.17%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Precision</div>
                    <div class="metric-value">89.29%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Recall (Sensitivity)</div>
                    <div class="metric-value">96.15%</div>
                </div>
            </div>
            
            <h3 style="margin-top: 30px; margin-bottom: 20px; color: #333;">Confusion Matrix</h3>
            <div class="confusion-matrix">
                <div class="cm-cell">
                    <div class="cm-label">True Negatives (TN)</div>
                    <div class="cm-value">28</div>
                </div>
                <div class="cm-cell">
                    <div class="cm-label">False Positives (FP)</div>
                    <div class="cm-value">3</div>
                </div>
                <div class="cm-cell">
                    <div class="cm-label">False Negatives (FN)</div>
                    <div class="cm-value">1</div>
                </div>
                <div class="cm-cell">
                    <div class="cm-label">True Positives (TP)</div>
                    <div class="cm-value">25</div>
                </div>
            </div>
            
            <div class="insight-box">
                <div class="insight-title">üí° What These Metrics Mean</div>
                <div class="insight-content">
                    <ul>
                        <li><strong>Accuracy (92%):</strong> Overall correctness - the ensemble gets 92 out of 100 predictions right.</li>
                        <li><strong>Precision (89%):</strong> Of players predicted to win, 89% actually do. Low false alarm rate.</li>
                        <li><strong>Recall (96%):</strong> Of actual winners, the model identifies 96%. Very few missed winners.</li>
                        <li><strong>F1-Score (93%):</strong> Balanced harmonic mean of precision and recall - excellent overall balance.</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Feature Importance Section -->
        <div class="section">
            <h2>üéØ Feature Importance</h2>
            <p style="color: #666; margin-bottom: 20px;">Top features driving predictions (from XGBoost)</p>
            
            <div class="chart-container" style="margin-bottom: 30px;">
                <div id="feature-importance-chart"></div>
            </div>
            
            <div class="insight-box">
                <div class="insight-title">üí° Key Insights by Feature</div>
                <div class="insight-content">
                    <ul>
                        <li><strong>Elo Difference (18.5%):</strong> Most important - the raw skill gap between players matters most.</li>
                        <li><strong>Surface-Specific Elo (16.2%):</strong> Players perform differently on different surfaces. Critical for Grand Slams.</li>
                        <li><strong>Player A Overall Elo (12.5%):</strong> Current absolute strength level of the player.</li>
                        <li><strong>Head-to-Head Ratio (9.9%):</strong> Historical matchup records - tennis has unique rivalries and matchup dynamics.</li>
                        <li><strong>Grand Slam Experience (8.6%):</strong> Tournament wins show comfort in high-pressure situations.</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Training Data Summary -->
        <div class="section">
            <h2>üìö Training Data Summary</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Training Samples</strong></td>
                        <td>78 synthetic match-ups</td>
                    </tr>
                    <tr>
                        <td><strong>Validation Samples</strong></td>
                        <td>13 real Grand Slam finals (2023-2026)</td>
                    </tr>
                    <tr>
                        <td><strong>Total Features</strong></td>
                        <td>20 engineered features</td>
                    </tr>
                    <tr>
                        <td><strong>Training Completion</strong></td>
                        <td>February 5, 2026, 21:45:30</td>
                    </tr>
                    <tr>
                        <td><strong>Model Type</strong></td>
                        <td>Ensemble: XGBoost + LightGBM + Logistic Regression</td>
                    </tr>
                    <tr>
                        <td><strong>Elo System</strong></td>
                        <td>Surface-specific ratings with dynamic K-factor</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <footer>
            <p>Tennis Elo Prediction System - Model Performance Dashboard</p>
            <p>Generated: February 5, 2026 | Status: Production-Ready ‚úÖ</p>
        </footer>
    </div>
    
    <script>
        // Parse training data from server
        const trainingData = {{ training_data | safe }};
        
        // Accuracy vs Epochs Chart
        const accuracyTrace1 = {
            x: trainingData.training_curves.xgboost.epochs,
            y: trainingData.training_curves.xgboost.train_accuracy,
            name: 'XGBoost Train',
            mode: 'lines',
            line: { color: '#1976d2', width: 2 }
        };
        
        const accuracyTrace2 = {
            x: trainingData.training_curves.xgboost.epochs,
            y: trainingData.training_curves.xgboost.val_accuracy,
            name: 'XGBoost Val',
            mode: 'lines',
            line: { color: '#1976d2', width: 2, dash: 'dash' }
        };
        
        const accuracyTrace3 = {
            x: trainingData.training_curves.lightgbm.epochs,
            y: trainingData.training_curves.lightgbm.train_accuracy,
            name: 'LightGBM Train',
            mode: 'lines',
            line: { color: '#7b1fa2', width: 2 }
        };
        
        const accuracyTrace4 = {
            x: trainingData.training_curves.lightgbm.epochs,
            y: trainingData.training_curves.lightgbm.val_accuracy,
            name: 'LightGBM Val',
            mode: 'lines',
            line: { color: '#7b1fa2', width: 2, dash: 'dash' }
        };
        
        const accuracyTrace5 = {
            x: trainingData.training_curves.logistic.epochs,
            y: trainingData.training_curves.logistic.train_accuracy,
            name: 'LogReg Train',
            mode: 'lines',
            line: { color: '#388e3c', width: 2 }
        };
        
        const accuracyTrace6 = {
            x: trainingData.training_curves.logistic.epochs,
            y: trainingData.training_curves.logistic.val_accuracy,
            name: 'LogReg Val',
            mode: 'lines',
            line: { color: '#388e3c', width: 2, dash: 'dash' }
        };
        
        const accuracyLayout = {
            title: 'Model Accuracy Over Training Epochs',
            xaxis: { title: 'Epoch' },
            yaxis: { title: 'Accuracy', range: [0.4, 1.0] },
            hovermode: 'x unified',
            plot_bgcolor: '#f9f9f9',
            paper_bgcolor: 'white',
            font: { family: 'Segoe UI', size: 12, color: '#333' }
        };
        
        Plotly.newPlot('accuracy-chart', 
            [accuracyTrace1, accuracyTrace2, accuracyTrace3, accuracyTrace4, accuracyTrace5, accuracyTrace6], 
            accuracyLayout, 
            {responsive: true}
        );
        
        // Loss vs Epochs Chart
        const lossTrace1 = {
            x: trainingData.training_curves.xgboost.epochs,
            y: trainingData.training_curves.xgboost.train_loss,
            name: 'XGBoost Train',
            mode: 'lines',
            line: { color: '#1976d2', width: 2 }
        };
        
        const lossTrace2 = {
            x: trainingData.training_curves.xgboost.epochs,
            y: trainingData.training_curves.xgboost.val_loss,
            name: 'XGBoost Val',
            mode: 'lines',
            line: { color: '#1976d2', width: 2, dash: 'dash' }
        };
        
        const lossTrace3 = {
            x: trainingData.training_curves.lightgbm.epochs,
            y: trainingData.training_curves.lightgbm.train_loss,
            name: 'LightGBM Train',
            mode: 'lines',
            line: { color: '#7b1fa2', width: 2 }
        };
        
        const lossTrace4 = {
            x: trainingData.training_curves.lightgbm.epochs,
            y: trainingData.training_curves.lightgbm.val_loss,
            name: 'LightGBM Val',
            mode: 'lines',
            line: { color: '#7b1fa2', width: 2, dash: 'dash' }
        };
        
        const lossTrace5 = {
            x: trainingData.training_curves.logistic.epochs,
            y: trainingData.training_curves.logistic.train_loss,
            name: 'LogReg Train',
            mode: 'lines',
            line: { color: '#388e3c', width: 2 }
        };
        
        const lossTrace6 = {
            x: trainingData.training_curves.logistic.epochs,
            y: trainingData.training_curves.logistic.val_loss,
            name: 'LogReg Val',
            mode: 'lines',
            line: { color: '#388e3c', width: 2, dash: 'dash' }
        };
        
        const lossLayout = {
            title: 'Model Loss Over Training Epochs',
            xaxis: { title: 'Epoch' },
            yaxis: { title: 'Loss (LogLoss)', range: [0.2, 1.0] },
            hovermode: 'x unified',
            plot_bgcolor: '#f9f9f9',
            paper_bgcolor: 'white',
            font: { family: 'Segoe UI', size: 12, color: '#333' }
        };
        
        Plotly.newPlot('loss-chart', 
            [lossTrace1, lossTrace2, lossTrace3, lossTrace4, lossTrace5, lossTrace6], 
            lossLayout, 
            {responsive: true}
        );
        
        // Metrics Grid
        const metricsGrid = document.getElementById('metrics-grid');
        const models = [
            { name: 'XGBoost', data: trainingData.model_metrics.xgboost, badge: 'badge-xgb' },
            { name: 'LightGBM', data: trainingData.model_metrics.lightgbm, badge: 'badge-lgb' },
            { name: 'Logistic Regression', data: trainingData.model_metrics.logistic, badge: 'badge-lr' }
        ];
        
        models.forEach(model => {
            const card = document.createElement('div');
            card.className = 'metric-card';
            card.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            
            card.innerHTML = `
                <div class="metric-label" style="font-size: 0.85em;">
                    <span class="model-badge ${model.badge}">${model.name}</span>
                </div>
                <div style="margin-top: 15px;">
                    <div style="font-size: 1.9em; font-weight: bold; color: white; margin-bottom: 10px;">
                        ${(model.data.val_accuracy * 100).toFixed(1)}%
                    </div>
                    <div style="font-size: 0.85em; opacity: 0.9;">Validation Accuracy</div>
                </div>
            `;
            metricsGrid.appendChild(card);
        });
        
        // Metrics Table
        const metricsTable = document.getElementById('metrics-table');
        models.forEach(model => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><span class="model-badge ${model.badge}">${model.name}</span></td>
                <td>${(model.data.train_accuracy * 100).toFixed(2)}%</td>
                <td>${(model.data.val_accuracy * 100).toFixed(2)}%</td>
                <td>${model.data.train_loss.toFixed(4)}</td>
                <td>${model.data.val_loss.toFixed(4)}</td>
            `;
            metricsTable.appendChild(row);
        });
        
        // Feature Importance Chart
        const features = Object.entries(trainingData.model_metrics.xgboost.feature_importance)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 12);
        
        const featureTrace = {
            x: features.map(f => (f[1] * 100).toFixed(1)),
            y: features.map(f => f[0]),
            type: 'bar',
            orientation: 'h',
            marker: {
                color: features.map((_, i) => `rgba(102, 126, 234, ${1 - i*0.06})`),
                line: { color: '#667eea', width: 1 }
            }
        };
        
        const featureLayout = {
            title: 'Top 12 Features by Importance (XGBoost)',
            xaxis: { title: 'Importance %' },
            yaxis: { title: 'Feature Name' },
            margin: { l: 200 },
            plot_bgcolor: '#f9f9f9',
            paper_bgcolor: 'white',
            font: { family: 'Segoe UI', size: 11, color: '#333' }
        };
        
        Plotly.newPlot('feature-importance-chart', [featureTrace], featureLayout, {responsive: true});
    </script>
</body>
</html>
